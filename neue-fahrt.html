<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ausbildungsstand - BW Fahrschul-Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type="radio"].ampel-radio { display: none; }
        input[type="radio"].ampel-radio:checked + label {
            opacity: 1;
            transform: scale(1.15);
            border: 2px solid #1e293b;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }
        .ampel-label { opacity: 0.3; transition: all 0.2s ease-in-out; }
        
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary { border-bottom-width: 1px; border-color: #e2e8f0; border-bottom-left-radius: 0; border-bottom-right-radius: 0; }
        
        /* Versteckt die Pfeile in Number-Inputs für saubereres Design */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-gray-100 text-slate-800 font-sans antialiased pb-28">

    <div class="max-w-2xl mx-auto bg-white min-h-screen shadow-2xl relative flex flex-col">

        <header class="bg-slate-800 text-white p-4 sticky top-0 z-50 shadow-md flex items-center justify-between">
            <div class="flex items-center">
                <button onclick="window.location.href='index.html'" type="button" class="mr-4 p-2 bg-slate-700 rounded-full hover:bg-slate-600 active:scale-95">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <div>
                    <h1 class="text-xl font-bold tracking-wide">Ausbildungsstand</h1>
                    <p class="text-xs text-slate-300">Stufenplan inkl. Wiederholungszähler</p>
                </div>
            </div>
        </header>

        <main class="flex-1 p-4">
            <form id="fahrtForm" onsubmit="saveFahrt(event)">
                
                <div class="mb-6 bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <label class="block text-sm font-bold text-slate-700 mb-2 uppercase tracking-wide">Schüler-ID</label>
                    <select name="schuelerId" id="schuelerSelect" required class="w-full p-3 rounded-lg border border-slate-300 bg-white font-bold text-slate-800 text-lg"></select>
                </div>

                <div class="flex justify-end mb-2 pr-2">
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-12">
                        <span>Anzahl</span>
                        <span>Bewertung</span>
                    </span>
                </div>

                <script>
                    function generateRow(i, item) {
                        return `
                        <div class="flex items-center justify-between py-3 border-b border-slate-100 last:border-0">
                            <span class="text-xs font-medium text-slate-700 w-1/2 pr-2">${i}. ${item}</span>
                            <div class="flex items-center justify-end w-1/2 space-x-3">
                                <div class="flex items-center bg-slate-200 rounded-lg p-1 shadow-inner">
                                    <button type="button" onclick="let inp = document.getElementById('count_${i}'); inp.value = Math.max(0, parseInt(inp.value || 0) - 1);" class="w-6 h-6 bg-white rounded flex items-center justify-center font-bold text-slate-600 active:scale-95">-</button>
                                    <input type="number" name="count_${i}" id="count_${i}" value="0" min="0" class="w-6 text-center bg-transparent font-bold text-sm outline-none" readonly>
                                    <button type="button" onclick="let inp = document.getElementById('count_${i}'); inp.value = parseInt(inp.value || 0) + 1;" class="w-6 h-6 bg-white rounded flex items-center justify-center font-bold text-slate-600 active:scale-95">+</button>
                                </div>
                                <div class="flex space-x-1.5">
                                    <input type="radio" name="item_${i}" id="i${i}_rot" value="rot" class="ampel-radio"><label for="i${i}_rot" class="ampel-label w-7 h-7 rounded-full bg-red-500 cursor-pointer"></label>
                                    <input type="radio" name="item_${i}" id="i${i}_gelb" value="gelb" class="ampel-radio"><label for="i${i}_gelb" class="ampel-label w-7 h-7 rounded-full bg-yellow-400 cursor-pointer"></label>
                                    <input type="radio" name="item_${i}" id="i${i}_gruen" value="gruen" class="ampel-radio"><label for="i${i}_gruen" class="ampel-label w-7 h-7 rounded-full bg-green-500 cursor-pointer"></label>
                                </div>
                            </div>
                        </div>`;
                    }
                </script>

                <details class="mb-3 bg-white rounded-xl shadow-sm border border-slate-300 overflow-hidden">
                    <summary class="p-4 font-bold text-slate-800 bg-slate-100 cursor-pointer flex justify-between items-center active:bg-slate-200">
                        Grundstufe (1 - 12) <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="p-3">
                        <script>
                            const grundstufe = ["Einweisung in das Ausbildungsfahrzeug", "Techn. Durchsichten (vor, während, nach der Benutzung)", "Ladungssicherung", "Fahrtechn. Vorbereitungen", "Handhabung Bedienungseinrichtung", "Bedienung EG-Kontrollgerät", "Anfahr-, Schalt- und Lenkübungen", "Fahren mit geringer Geschwindigkeit", "Abbremsen aus geringer Geschwindigkeit", "Rückwärtsfahren mit Einweiser", "An- und Abkuppeln des Anhängers", "Maßnahmen beim Verlassen"];
                            grundstufe.forEach((item, index) => document.write(generateRow(index + 1, item)));
                        </script>
                        <div class="mt-2 pt-2 border-t border-slate-200">
                            <textarea name="notizen_grundstufe" rows="2" placeholder="Notizen zur Grundstufe..." class="w-full p-2 text-sm rounded bg-slate-50 border border-slate-300"></textarea>
                        </div>
                    </div>
                </details>

                <details class="mb-3 bg-white rounded-xl shadow-sm border border-slate-300 overflow-hidden">
                    <summary class="p-4 font-bold text-slate-800 bg-slate-100 cursor-pointer flex justify-between items-center active:bg-slate-200">
                        Aufbaustufe A (13 - 33) <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="p-3">
                        <script>
                            const aufbauA = ["Verhalten beim Anfahren", "Gangwechsel", "Fahrbahnbenutzung", "Abbiegen an Kreuzungen", "Fahrstreifenwechsel", "Beobachtung Verkehrsraum", "Verkehrszeichen", "Geschwindigkeit", "Sicherheitsabstände", "Überholen und Vorbeifahren", "- durch Lichtzeichen", "- mit und ohne Verkehrszeichen", "Kreisverkehr", "Bahnübergänge", "Gegenüber Fußgängern/Radfahrern", "Fußgängerüberwege", "Verkehrsberuhigte Bereiche", "Öffentliche Verkehrsmittel", "Durchfahren von Engstellen", "Warneinrichtungen", "Sicherung liegengebliebener Fzg"];
                            aufbauA.forEach((item, index) => document.write(generateRow(index + 13, item)));
                        </script>
                        <div class="mt-2 pt-2 border-t border-slate-200">
                            <textarea name="notizen_aufbauA" rows="2" placeholder="Notizen Aufbaustufe A..." class="w-full p-2 text-sm rounded bg-slate-50 border border-slate-300"></textarea>
                        </div>
                    </div>
                </details>

                <details class="mb-3 bg-white rounded-xl shadow-sm border border-slate-300 overflow-hidden">
                    <summary class="p-4 font-bold text-slate-800 bg-slate-100 cursor-pointer flex justify-between items-center active:bg-slate-200">
                        Fahraufgaben DFE (34) <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="p-3">
                        <script>document.write(generateRow(34, "Wenden und Rückwärtsfahren (DFE)"));</script>
                        <div class="mt-2 pt-2 border-t border-slate-200">
                            <textarea name="notizen_dfe" rows="2" placeholder="Notizen DFE..." class="w-full p-2 text-sm rounded bg-slate-50 border border-slate-300"></textarea>
                        </div>
                    </div>
                </details>

                <details class="mb-3 bg-white rounded-xl shadow-sm border border-slate-300 overflow-hidden">
                    <summary class="p-4 font-bold text-slate-800 bg-slate-100 cursor-pointer flex justify-between items-center active:bg-slate-200">
                        Aufbaustufe B & C (35 - 55) <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="p-3">
                        <script>
                            const aufbauBC = ["Fahren auf Feld-, Wald-, Wiesenwegen", "Bodenverhältnisse", "Materialschonendes Fahren", "Geschwindigkeit und Gangwahl", "Geländegang / Getriebesperren", "Befahren von Fahrspuren", "Gefahrbremsung (mit ABV)", "Ausweichen von Hindernissen", "Steigungen und Gefälle", "Überwinden von Querrinnen", "Geländebeurteilung", "Rückwärts in Parklücke", "Rückwärts quer einparken", "Rückwärts unter Ausnutzung Einmündung", "Rückwärts an Rampe", "Abfahrtkontrolle", "Rückwärts geradeaus Rampe", "Umkehren durch Rückwärtsfahren", "Sicherheitskontrolle", "Verbinden und Trennen", "Abstellen des Anhängers"];
                            aufbauBC.forEach((item, index) => document.write(generateRow(index + 35, item)));
                        </script>
                        <div class="mt-2 pt-2 border-t border-slate-200">
                            <textarea name="notizen_aufbauC" rows="2" placeholder="Notizen Aufbau B/C..." class="w-full p-2 text-sm rounded bg-slate-50 border border-slate-300"></textarea>
                        </div>
                    </div>
                </details>

                <details class="mb-3 bg-white rounded-xl shadow-sm border border-slate-300 overflow-hidden">
                    <summary class="p-4 font-bold text-slate-800 bg-slate-100 cursor-pointer flex justify-between items-center active:bg-slate-200">
                        Leistungsstufe (56 - 63) <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="p-3">
                        <script>
                            const leistung = ["Vorausschauendes Fahren", "Beobachtung Verkehrsteilnehmer", "Beobachtung Fahrverhalten anderer", "Beobachtung Verkehrsraum", "Bremsen in Gefahrensituationen", "Überlandfahrten", "Autobahn", "Dunkelheit"];
                            leistung.forEach((item, index) => document.write(generateRow(index + 56, item)));
                        </script>
                        <div class="mt-2 pt-2 border-t border-slate-200">
                            <textarea name="notizen_leistung" rows="2" placeholder="Notizen Leistungsstufe..." class="w-full p-2 text-sm rounded bg-slate-50 border border-slate-300"></textarea>
                        </div>
                    </div>
                </details>

                <details class="mb-6 bg-white rounded-xl shadow-sm border border-slate-300 overflow-hidden">
                    <summary class="p-4 font-bold text-slate-800 bg-slate-100 cursor-pointer flex justify-between items-center active:bg-slate-200">
                        Reifestufe / Einweiser (64 - 70) <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="p-3">
                        <script>
                            const reife = ["Verhalten in komplizierten Situationen", "Vermeiden risikoreicher Situationen", "Fahren in unbekannten Räumen", "Fahren unter Prüfungsbedingungen", "Feststellen der Prüfungsreife"];
                            reife.forEach((item, index) => document.write(generateRow(index + 64, item)));
                        </script>
                        
                        <div class="flex items-center justify-between py-3 border-b border-slate-100">
                            <label class="text-xs font-medium text-slate-700 w-2/3 pr-2">69. Einweisertätigkeit Tag</label>
                            <input type="number" name="item_69_minuten" placeholder="Min." class="w-20 p-2 text-sm rounded border border-slate-300 text-center">
                        </div>
                        <div class="flex items-center justify-between py-3 border-b border-slate-100">
                            <label class="text-xs font-medium text-slate-700 w-2/3 pr-2">70. Einweisertätigkeit Nacht</label>
                            <input type="number" name="item_70_minuten" placeholder="Min." class="w-20 p-2 text-sm rounded border border-slate-300 text-center">
                        </div>

                        <div class="mt-2 pt-2 border-t border-slate-200">
                            <textarea name="notizen_reifestufe" rows="2" placeholder="Notizen Reife/Einweiser..." class="w-full p-2 text-sm rounded bg-slate-50 border border-slate-300"></textarea>
                        </div>
                    </div>
                </details>

                <div class="fixed bottom-0 left-0 w-full p-4 bg-white border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-50">
                    <div class="max-w-2xl mx-auto">
                        <button type="submit" class="w-full bg-blue-800 text-white font-bold text-lg py-4 rounded-xl shadow-lg hover:bg-blue-900 active:scale-95 transition-all">
                            Dokumentation speichern
                        </button>
                    </div>
                </div>
            </form>
        </main>
    </div>

    <script>
        // Lade IDs ins Dropdown
        const ids = JSON.parse(localStorage.getItem('bw_aktive_schueler')) || [];
        const select = document.getElementById('schuelerSelect');
        if (ids.length === 0) {
            select.innerHTML = '<option value="">Bitte erst auf der Startseite Schüler anlegen!</option>';
        } else {
            select.innerHTML = '<option value="" disabled selected>Fahrschüler auswählen...</option>';
            ids.forEach(id => select.innerHTML += `<option value="${id}">${id}</option>`);
        }

        function saveFahrt(event) {
            event.preventDefault(); 
            const data = Object.fromEntries(new FormData(event.target).entries());
            data.datum = new Date().toISOString();
            let arr = JSON.parse(localStorage.getItem('bw_ausbildungsstand')) || [];
            arr.push(data);
            localStorage.setItem('bw_ausbildungsstand', JSON.stringify(arr));
            alert('✅ Fahrt inkl. Zähler erfolgreich gespeichert!');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
